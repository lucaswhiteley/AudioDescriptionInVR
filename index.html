<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>TEST 5 First three.js app</title>
    <style>
        body {
            margin: 0;
        }
    </style>
</head>

<body>
    <!--First import the code for three.js and FirstPersonController from file-->
    <script src="js/three.js"></script>
    <script src="js/FirstPersonControls.js"></script>
    
    <!-- not working??? has to be run on a server?? -->
    <!-- <script type="module" src="js/FirstPersonControls.js"></script> -->

    <script>
        
        var renderer;
        var scene;
        var camera;
        //var testCube;
        var clock = new THREE.Clock();

        itit();
        populate();
        animate();



        //defines the animation of the scene and calls the renderer.
        function animate()
        {
            //IN PROGRESS
            var delta = clock.getDelta();

            fpcCamera.movementSpeed = 101
            fpcCamera.update(delta);



            requestAnimationFrame(animate);
            //Renders the scene
            renderer.render(scene, camera);
        }

        //Initialises the scene and other essential things before the program runs
        function itit()
        {
            //ititialises the renderer and sets it to the size of the window
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement)

            console.log("window.innerWidth = " + window.innerWidth);
            console.log("window.innerHeight = " + window.innerHeight);


            //Initialises the scene
            scene = new THREE.Scene();

            //Initialises the camera
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
	        camera.position.set(40, 40, 400);
            camera.lookAt(scene.position);
        	scene.add(camera);



            //IN PROGRESS
            fpcCamera = new THREE.FirstPersonControls(camera, document.body);


            var gloorGeometry = new THREE.PlaneGeometry( window.innerWidth , window.innerHeight, 1, 1 );
	        var floorMaterial = new THREE.MeshBasicMaterial( { color: 0x00ffff } );
	        var floor = new THREE.Mesh( gloorGeometry, floorMaterial );
            //This line renders both sides of the plane
        	floor.material.side = THREE.DoubleSide;
	        floor.rotation.x = (-Math.PI / 2) ;
            floor.position.y = 0;
            floor.position.x = 0;
            floor.position.z = 0;


	        scene.add(floor); 
        }

        //populates the scene with all of the objects
        function populate()
        {
                //Arrays to store the positions of the objects
                let objectsX = [];
                let objectsY = [];
        
            //Create a loop to create a random number of cubes, spheres and cones

            var numToGen = Math.floor(Math.random()*6) + 3;
            //generates between 2 and 5 cubes
            for (let i = 0; i < numToGen; i ++)
            {


                ///Choosing the shape of the object
                let z = Math.floor(Math.random()*3) + 1;
                switch(z)
                {
                    case 1:
                        //Box
                        geometry = new THREE.BoxGeometry(100,100,100)
                        break;
                    case 2:
                        //Sphere
                        geometry = new THREE.SphereGeometry(60)
                        break;
                    case 3:
                        //Cone
                        geometry = new THREE.ConeGeometry(50,100)
                        break;
                }



                //choosing the colour of the object
                let x = Math.floor(Math.random()*3) + 1;
                switch(x)
                {
                    case 1:
                        //red
                        material = new THREE.MeshBasicMaterial({color: 0xff1100});
                        break;
                    case 2:
                        //Spring Green
                        material = new THREE.MeshBasicMaterial({color: 0x00ff59});
                        break;
                    case 3:
                        //Purple Pizzazz
                        material = new THREE.MeshBasicMaterial({color: 0xff00e1});
                        break;
                }



                mesh = new THREE.Mesh(geometry, material)
                //since 0 is the middle of the plane, the position could be negative too
                mesh.position.x = Math.floor(Math.random()*1850) -900;
                mesh.position.y = 50;

                //loops through the x array to see if there are any overlaps
                for (let j = 0; j< objectsX.length; j++)
                {
                    console.log(objectsX.length);

                    if( objectsX[j] -200 <= mesh.position.x <= objectsX[j] + 200)
                    {
                        mesh.position.x = Math.floor(Math.random()*800) -400;
                        console.log("X OVERLAP, ORIG:" + objectsX[j] + "NEW: " + mesh.position.x)  
                    }
                }

                //adds the x position of the object to the Array
                objectsX[i] = mesh.position.x;
                mesh.position.z = Math.floor(Math.random()*810) -405;

                //loops through the Y array to see if there are any overlaps
                for (let k = 0; k< objectsY.length; k++)
                {
                    console.log(objectsY.length);

                    if( objectsY[k] -200 <= mesh.position.z <= objectsY[k] + 200)
                    {
                        mesh.position.z = Math.floor(Math.random()*800) -400;
                        console.log("Y OVERLAP, ORIG:" + objectsY[k] + "NEW: " + mesh.position.y)  
                    }

                }

                //adds the y position of the object to the Array
                objectsY[i] = mesh.position.z;

                //debug
                console.log(objectsX)
                console.log(objectsY)


                scene.add(mesh);
            } 
            
        }
    </script>
</body>

</html>